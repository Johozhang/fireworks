<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>点击屏幕放烟花啦~~</title>
	<style type="text/css">
		* {
			margin:0;
			padding: 0;
		}
		body {
			background-color: #000;
		}
		canvas {
			display: block;
		}
	</style>
</head>
<body>
	<canvas id="canvas"></canvas>
	<script type="text/javascript">
	var canvas = document.getElementById("canvas");
	var ctx = canvas.getContext("2d");
	var cw = window.innerWidth;
	var ch = window.innerHeight;

	canvas.width = cw;
	canvas.height = ch;

	var hue = 120,
		mx = 0,
		my = 0,
		mousedown = false;
	var particles = [];
	function random(min, max) {
		return Math.random() * (max - min) + min;
	}
	window.requestAnimFrame = (function() {
		return window.requestAimationFrame || window.webkitRequestAnimateFrame || window.mozRequestAnimationFrame || function(callback) {
			window.setTimeout(callback, 1000/60);
		};
	})();
	function Particle(x, y) {
		this.x = x;
		this.y = y;

		this.coordinate = [];
		this.coordinateCount = 5;
		while(this.coordinateCount--) {
			this.coordinate.push([this.x,this.y]);
		}

		this.angle = random(0, Math.PI*2);
		this.speed = random(1, 10);

		this.frication = 0.95;
		this.gravity = 1;

		this.hue = random( hue - 50, hue + 50);
		this.brightness = random(50, 80);
		this.alpha = 1;

		this.decay = random(0.015, 0.03);
	}

	Particle.prototype.update = function( index ){
		this.coordinate.pop();
		this.coordinate.unshift([this.x,this.y]);

		this.speed *= this.frication;
		this.x += Math.cos(this.angle) * this.speed;
		this.y += Math.sin(this.angle) * this.speed + this.gravity;

		this.alpha -= this.decay;

		if(this.alpha <= this.decay) {
			particles.splice(index, 1);
		}
	}

	Particle.prototype.draw = function() {
		ctx.beginPath();
		ctx.moveTo(this.coordinate[this.coordinate.length - 1][0], this.coordinate[this.coordinate.length - 1][1]);
		ctx.lineTo(this.x, this.y);
		ctx.strokeStyle = 'hsla('+this.hue+',100%,'+this.brightness+'%,'+this.alpha+')';
		ctx.stroke();
	}

	function createParticles(x, y) {
		var particleCount = 30;
		while( particleCount --) {
			particles.push(new Particle(x, y));
		}
	}

	function loop() {
		requestAnimFrame( loop );
		hue = random(0,360);
		ctx.globalCompositeOperation = 'destination-out';

		ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
		ctx.fillRect(0, 0, cw, ch);
		ctx.globalCompositeOperation = 'lighter';


		var i = particles.length;
		while (i--) {
			particles[i].draw();
			particles[i].update(i);
		}
		if(mousedown) {
			createParticles(mx, my);
		}

	}
	canvas.addEventListener("touchstart", function(e) {
		mx = e.pageX - canvas.offsetLeft;
		my = e.pageY - canvas.offsetTop;
	}, false)

	canvas.addEventListener("touchmove", function(e) {
		e.preventDefault();
		mousedown = true;
	})

	canvas.addEventListener("touchend", function(e) {
		e.preventDefault();
		mousedown = false;
	})
	window.onload = loop;
	</script>
</body>
</html>